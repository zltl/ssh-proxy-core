# SSH Proxy Core - Test Configuration
# Used by: make run

[server]
bind_addr = 0.0.0.0
port = 2222
host_key = /tmp/ssh_proxy_host_key

[logging]
level = debug
audit_dir = /tmp/ssh_proxy_audit

[limits]
max_sessions = 100
session_timeout = 3600
auth_timeout = 60

# Test user - password is "test123"
# Generate with: openssl passwd -6 -salt saltsalt 'test123'
[user:test]
password_hash = $6$saltsalt$U5d2t4MFT.Hn/auqLjcfU6R/lm2Y71FvBwABEOht/UpRtNzcFvzGl/oU6V38pYgY8ZpicOa.0ESff5jRNylZM.
enabled = true

[user:admin]
password_hash = $6$saltsalt$U5d2t4MFT.Hn/auqLjcfU6R/lm2Y71FvBwABEOht/UpRtNzcFvzGl/oU6V38pYgY8ZpicOa.0ESff5jRNylZM.
enabled = true

# Routes - map users to upstream servers
[route:admin]
upstream = 127.0.0.1
port = 22
user = ubuntu
privkey = ~/.ssh/id_rsa

[route:test]
upstream = 127.0.0.1
port = 22
user = ubuntu

# Default route
[route:*]
upstream = 127.0.0.1
port = 22
user = ubuntu

# ============ Feature Policy Control ============
# Controls what SSH features users can use
# Format: [policy:user] or [policy:user@upstream]

# Admin - allow all features
[policy:admin]
allow = all

# Test user - allow most features, deny port forwarding
[policy:test]
allow = shell, exec, scp, sftp, git
deny = port_forward, x11, agent

# Default policy - basic shell and file transfer
[policy:*]
allow = shell, exec, download, sftp_list
deny = upload, port_forward, git_push

# ============ Per-Upstream Policies ============
# More specific policies for certain upstream servers

# Any user accessing localhost - allow upload (for testing)
[policy:*@127.0.0.1]
allow = all
